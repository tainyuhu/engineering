"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[818],{8501:function(e,a,t){t.r(a),t.d(a,{default:function(){return W}});var r=t(6252),o=t(3577),n=t(9095),l=t(9773),s=t(1669),c=t(7737),u=t(2793);const d=e=>((0,r.dD)("data-v-17ad756a"),e=e(),(0,r.Cn)(),e),i={class:"mb-3",style:{"padding-left":"20px",display:"flex","align-items":"center"}},p=d((()=>(0,r._)("span",{class:"font-weight-bold ml-2"},"瀏覽總迴路工程進度：",-1))),g={class:"function-row"},_={class:"status-and-page-size-selector"},h=d((()=>(0,r._)("span",null,"狀態：",-1))),m={key:0,class:"py-2 d-flex justify-center"},b={key:1},D={key:0,class:"div-container"},w={key:1,class:"div-container"},y={key:2,class:"div-container"},k={key:3,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},x={key:4,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},S={key:5,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}};function f(e,a,t,d,f,q){const N=(0,r.up)("WeekLoopTable"),T=(0,r.up)("AllQuarterLoopTable"),C=(0,r.up)("QuarterLoopTable"),M=(0,r.up)("SiteSelectionChart");return(0,r.wg)(),(0,r.j4)(s.K,null,{default:(0,r.w5)((()=>[(0,r._)("div",i,[(0,r.Wm)(c.t,{color:"blue",onClick:q.goBack},{default:(0,r.w5)((()=>[(0,r.Uk)("mdi-chevron-left-box")])),_:1},8,["onClick"]),p]),(0,r._)("div",g,[(0,r._)("div",_,[h,(0,r.Wm)(n.T,{class:(0,o.C_)("table"===f.displayMode?"report-btn":"table-btn"),onClick:q.toggleDisplayMode},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(q.displayModeText),1)])),_:1},8,["class","onClick"])]),f.showDetails&&"table"===f.displayMode?((0,r.wg)(),(0,r.iD)("div",m,[(0,r.Wm)(l.fF,{mandatory:"",modelValue:f.timeMode,"onUpdate:modelValue":a[0]||(a[0]=e=>f.timeMode=e),class:"time-toggle",variant:"outlined"},{default:(0,r.w5)((()=>[(0,r.Wm)(n.T,{class:"time-btn",value:"quarter"},{default:(0,r.w5)((()=>[(0,r.Uk)("季")])),_:1}),(0,r.Wm)(n.T,{class:"time-btn",value:"week"},{default:(0,r.w5)((()=>[(0,r.Uk)("週")])),_:1})])),_:1},8,["modelValue"])])):(0,r.kq)("",!0),"table"===f.displayMode?((0,r.wg)(),(0,r.iD)("div",b,[(0,r.Wm)(n.T,{class:(0,o.C_)("engineering"===f.projectType?"bank-btn":"engineering-btn"),onClick:q.toggleProjectType},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(q.projectTypeText),1)])),_:1},8,["class","onClick"]),(0,r.Wm)(n.T,{class:(0,o.C_)(["overview-btn",{"btn-active":!f.showDetails}]),rounded:"0",variant:"outlined",onClick:a[1]||(a[1]=e=>f.showDetails=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 即時 ")])),_:1},8,["class"]),(0,r.Wm)(n.T,{class:(0,o.C_)(["details-btn",{"btn-active":f.showDetails}]),rounded:"0",variant:"outlined",onClick:a[2]||(a[2]=e=>f.showDetails=!0)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 詳情 ")])),_:1},8,["class"])])):(0,r.kq)("",!0)]),"week"===f.timeMode&&f.showDetails&&"table"===f.displayMode?((0,r.wg)(),(0,r.iD)("div",D,[(0,r.Wm)(N,{allDateRanges:q.paginatedDateRanges,weekTableData:q.paginatedData,percentagedata:f.percentageData},null,8,["allDateRanges","weekTableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:f.currentPage,"onUpdate:modelValue":a[3]||(a[3]=e=>f.currentPage=e),length:q.totalPages},null,8,["modelValue","length"])])):(0,r.kq)("",!0),"quarter"===f.timeMode&&f.showDetails&&"table"===f.displayMode?((0,r.wg)(),(0,r.iD)("div",w,[(0,r.Wm)(T,{allDateRanges:q.paginatedDateRanges,quarterSummary:q.quarterSummary,quarterTableData:q.paginatedData,percentagedata:f.percentageData},null,8,["allDateRanges","quarterSummary","quarterTableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:f.currentPage,"onUpdate:modelValue":a[4]||(a[4]=e=>f.currentPage=e),length:q.totalPages},null,8,["modelValue","length"])])):(0,r.kq)("",!0),f.showDetails||"table"!==f.displayMode?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(C,{allDateRanges:q.paginatedDateRanges,quarterSummary:q.quarterSummary,TableData:q.paginatedData,percentagedata:f.percentageData},null,8,["allDateRanges","quarterSummary","TableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:f.currentPage,"onUpdate:modelValue":a[5]||(a[5]=e=>f.currentPage=e),length:q.totalPages},null,8,["modelValue","length"])])),"report"!==f.displayMode||f.showDetails?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",k,[(0,r.Wm)(M,{chartData:f.chartData},null,8,["chartData"])])),"report"===f.displayMode&&f.showDetails&&"quarter"===f.timeMode?((0,r.wg)(),(0,r.iD)("div",x,[(0,r.Wm)(M,{chartData:f.chartData},null,8,["chartData"])])):(0,r.kq)("",!0),"report"===f.displayMode&&f.showDetails&&"week"===f.timeMode?((0,r.wg)(),(0,r.iD)("div",S,[(0,r.Wm)(M,{chartData:f.chartData},null,8,["chartData"])])):(0,r.kq)("",!0)])),_:1})}t(560);var q=t(8541),N=t(8334),T=t(1738),C=t(614),M={components:{WeekLoopTable:N.Z,AllQuarterLoopTable:T.Z,QuarterLoopTable:C.Z,SiteSelectionChart:q.Z},data(){return{timeMode:"week",displayMode:"table",projectType:"engineering",showDetails:!1,weekTableData:[{actual:.0053,construction_status:2,date_range:"2023-12-31 - 2024-01-06",expected:0,loop_name:"SN2"},{actual:.0053,construction_status:2,date_range:"2024-01-07 - 2024-01-13",expected:0,loop_name:"SN2"},{actual:.0257,construction_status:2,date_range:"2024-01-14 - 2024-01-20",expected:0,loop_name:"SN2"},{actual:.0312,construction_status:2,date_range:"2024-01-21 - 2024-01-27",expected:0,loop_name:"SN2"},{actual:.0312,construction_status:2,date_range:"2024-01-28 - 2024-02-03",expected:0,loop_name:"SN2"},{actual:.0312,construction_status:2,date_range:"2024-02-04 - 2024-02-10",expected:0,loop_name:"SN2"},{actual:.0312,construction_status:2,date_range:"2024-02-11 - 2024-02-17",expected:.0124,loop_name:"SN2"},{actual:.0312,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:.0187,loop_name:"SN2"},{actual:.0109,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:0,loop_name:"SN1"},{actual:.0312,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:.0279,loop_name:"SN2"},{actual:.0109,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:0,loop_name:"SN1"},{actual:.0312,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:.0414,loop_name:"SN2"},{actual:.0109,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:0,loop_name:"SN1"},{actual:.0313,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0605,loop_name:"SN2"},{actual:.06,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN1"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN3"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN4"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN5"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN6"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN7"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN8"},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN9"}],quarterTableData:[{actual:.0313,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0605,loop_name:"SN2",year:2024,quarter:1,week:11},{actual:.06,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN1",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN3",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN4",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN5",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN6",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN7",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN8",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN9",year:2024,quarter:1,week:11}],TableData:[{actual:.0313,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0605,loop_name:"SN2",year:2024,quarter:1,week:11},{actual:.06,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN1",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN3",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN4",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN5",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN6",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN7",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN8",year:2024,quarter:1,week:11},{actual:0,construction_status:0,date_range:"2024-03-10 - 2024-03-16",expected:0,loop_name:"SN9",year:2024,quarter:1,week:11}],currentPage:1,perPage:3,chartData:{labels:[],datasets:[]},percentageData:[{loop_name:"SN1",percentage:.0991},{loop_name:"SN2",percentage:.128},{loop_name:"SN3",percentage:.1145},{loop_name:"SN4",percentage:.1175},{loop_name:"SN5",percentage:.1001},{loop_name:"SN6",percentage:.0808},{loop_name:"SN7",percentage:.1421},{loop_name:"SN8",percentage:.1212},{loop_name:"SN9",percentage:.0968}]}},watch:{displayMode(){this.updateChartData()},timeMode(){this.updateChartData()},showDetails(){this.updateChartData()}},async created(){this.selectedPlan=this.$route.query.Plan,this.selectedProject=this.$route.query.Project},mounted(){this.updateChartData()},computed:{displayModeText(){return"table"===this.displayMode?"表格":"報表"},projectTypeText(){return"engineering"===this.projectType?"工程":"銀行"},allDateRanges(){const e=new Set;return this.organizedLoopsData.forEach((a=>{a.date_ranges.forEach((a=>{e.add(a.date_range)}))})),Array.from(e)},quarterSummary(){let e=this.organizedLoopsData;if(console.log(e),!e.length)return[];const a=new Set;return e.forEach((e=>{e.date_ranges.forEach((e=>{const t=`${e.year}-Q${e.quarter}-${e.week}`;a.add(t)}))})),Array.from(a).map((e=>{const[a,t,r]=e.split("-");return{year:a,quarter:t.replace("Q",""),week:r}}))},totalPages(){const e=this.allDateRanges.length;return Math.ceil(e/this.perPage)},paginatedData(){this.organizedLoopsData.forEach((e=>{e.date_ranges.sort(((e,a)=>new Date(a.date_range.split(" - ")[0])-new Date(e.date_range.split(" - ")[0])))}));const e=this.organizedLoopsData.map((e=>{const a=[e.date_ranges[0]];let t=[];if(1===this.currentPage)t=e.date_ranges.slice(1,3);else{const a=1+3*(this.currentPage-2)+2,r=a+3;t=e.date_ranges.slice(a,r)}return{loop_name:e.loop_name,date_ranges:[...a,...t]}}));return e},paginatedDateRanges(){const e=(this.currentPage-1)*this.perPage,a=e+this.perPage,t=this.allDateRanges.sort(((e,a)=>new Date(a.split(" - ")[0])-new Date(e.split(" - ")[0]))),r=t[0];let o=t.slice(e,a);return o.includes(r)||(o=[r,...o].slice(0,a-e+1)),o},organizedLoopsData(){const e=[],a=new Map;let t=[];return this.showDetails?"quarter"===this.timeMode?t=this.quarterTableData:"week"===this.timeMode&&(t=this.weekTableData):t=this.TableData,t.forEach((e=>{const{loop_name:t,construction_status:r,date_range:o,actual:n,expected:l,year:s,quarter:c,week:u}=e;a.has(t)||a.set(t,{loop_name:t,date_ranges:[]});const d=a.get(t);let i=d.date_ranges.find((e=>e.date_range===o));i||(i={date_range:o,construction_status:r,records:[],year:s,quarter:c,week:u},d.date_ranges.push(i)),i.records.push({actual:n,expected:l})})),a.forEach((a=>{a.date_ranges.sort(((e,a)=>{const t=new Date(e.date_range.split(" - ")[0]),r=new Date(a.date_range.split(" - ")[0]);return r-t})),e.push(a)})),e}},methods:{goBack(){this.$router.go(-1)},toggleDisplayMode(){"table"===this.displayMode?(this.previousTimeMode=this.timeMode,this.previousShowDetails=this.showDetails,this.displayMode="report"):(this.displayMode="table",this.timeMode=this.previousTimeMode,this.showDetails=this.previousShowDetails)},toggleProjectType(){this.projectType="engineering"===this.projectType?"bank":"engineering"},generateChartData(){const e=(new Date).getFullYear(),a=this.TableData.filter((a=>a.year===e)),t=new Set(a.map((e=>`Q${e.quarter}`))),r=Array.from(t).sort(),o=new Map;a.forEach((e=>{const a=`Q${e.quarter}`,t=e.loop_name;o.has(t)||o.set(t,{actual:Array(r.length).fill(null),expected:Array(r.length).fill(null)});const n=o.get(t),l=r.indexOf(a);-1!==l&&(n.actual[l]=100*e.actual,n.expected[l]=100*e.expected)}));const n=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let l=0;const s=[];return o.forEach(((e,a)=>{const t=n[l++%n.length].color;s.push({label:`${a} Actual`,data:e.actual,backgroundColor:t,borderColor:t.replace("0.2","1"),borderWidth:5}),s.push({label:`${a} Expected`,data:e.expected,backgroundColor:t,borderColor:t.replace("0.2","1"),borderDash:[5,5]})})),{labels:r,datasets:s}},generateyearChartData(){const e=(new Date).getFullYear(),a=this.quarterTableData.filter((a=>a.year===e)),t=[...new Set(a.map((e=>`${e.year}Q${e.quarter}`)))].sort(),r=new Map;a.forEach((e=>{const a=`${e.year}Q${e.quarter}`,o=e.loop_name;r.has(o)||r.set(o,{actual:Array(t.length).fill(null),expected:Array(t.length).fill(null)});const n=r.get(o),l=t.indexOf(a);-1!==l&&(n.actual[l]=100*e.actual,n.expected[l]=100*e.expected)}));const o=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let n=0;const l=[];return r.forEach(((e,a)=>{const t=o[n++%o.length].color;l.push({label:`${a} Actual`,data:e.actual,backgroundColor:t,borderColor:t.replace("0.2","1"),borderWidth:5}),l.push({label:`${a} Expected`,data:e.expected,backgroundColor:t,borderColor:t.replace("0.2","1"),borderDash:[5,5]})})),{labels:t,datasets:l}},generatedaterangeChartData(){(new Date).getFullYear();const e=this.weekTableData,a=[...new Set(e.map((e=>e.date_range)))].sort(),t=new Map;e.forEach((e=>{const r=e.date_range,o=e.loop_name;t.has(o)||t.set(o,{actual:Array(a.length).fill(null),expected:Array(a.length).fill(null)});const n=t.get(o),l=a.indexOf(r);-1!==l&&(n.actual[l]=100*e.actual,n.expected[l]=100*e.expected)}));const r=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let o=0;const n=[];return t.forEach(((e,a)=>{const t=r[o++%r.length].color;n.push({label:`${a} Actual`,data:e.actual,backgroundColor:t,borderColor:t.replace("0.2","1"),borderWidth:5}),n.push({label:`${a} Expected`,data:e.expected,backgroundColor:t,borderColor:t.replace("0.2","1"),borderDash:[5,5]})})),{labels:a,datasets:n}},updateChartData(){this.showDetails?"quarter"===this.timeMode?this.chartData=this.generateyearChartData():"week"===this.timeMode&&(this.chartData=this.generatedaterangeChartData()):this.chartData=this.generateChartData()}}},v=t(3744);const P=(0,v.Z)(M,[["render",f],["__scopeId","data-v-17ad756a"]]);var W=P}}]);
//# sourceMappingURL=818.97d0e691.js.map