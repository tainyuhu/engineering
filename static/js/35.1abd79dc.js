"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[35],{9351:function(e,a,t){t.d(a,{Mw:function(){return d},QZ:function(){return g},UW:function(){return o},Up:function(){return s},ZP:function(){return c},iY:function(){return i},ob:function(){return l},uf:function(){return p},yP:function(){return n}});var r=t(9022);const n=(e,a,t,n)=>r.Z.get(`/api/v1/get_pv_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),s=(e,a,t,n)=>r.Z.get(`/api/v1/get_pv_all_quarter_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),o=(e,a,t,n)=>r.Z.get(`/api/v1/get_pv_quarter_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),l=(e,a,t,n)=>r.Z.get(`/api/v1/get_loop_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),c=(e,a,t,n)=>r.Z.get(`/api/v1/get_loop_all_quarter_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),i=(e,a,t,n)=>r.Z.get(`/api/v1/get_loop_quarter_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}}),p=(e,a)=>r.Z.get(`/api/v1/get_pv_quarter_chart_progress/${e}/${a}/`,{headers:{Accept:"application/json"}}),d=(e,a)=>r.Z.get(`/api/v1/get_pv_all_quarter_chart_progress/${e}/${a}/`,{headers:{Accept:"application/json"}}),g=(e,a,t,n)=>r.Z.get(`/api/v1/get_pv_week_chart_progress/${e}/${a}/${t}/${n}/`,{headers:{Accept:"application/json"}})},7148:function(e,a,t){t.r(a),t.d(a,{default:function(){return S}});var r=t(6252),n=t(3577),s=t(9095),o=t(9773),l=t(1669),c=t(7737),i=t(2793);const p=e=>((0,r.dD)("data-v-85e7cc18"),e=e(),(0,r.Cn)(),e),d={class:"mb-3",style:{"padding-left":"20px",display:"flex","align-items":"center"}},g=p((()=>(0,r._)("span",{class:"font-weight-bold ml-2"},"瀏覽迴路工程進度：",-1))),h={class:"mb-3",style:{"padding-left":"40px",display:"flex","align-items":"center"}},u=p((()=>(0,r._)("span",{class:"font-weight-bold ml-2"},"選擇迴路：",-1))),m=p((()=>(0,r._)("span",{class:"ml-1 note-span"},"※在下方選擇一個迴路後，才會顯示迴路的進度內容",-1))),_={class:"loops-selection"},b={class:"function-row"},v={key:0,class:"status-and-page-size-selector"},D=p((()=>(0,r._)("span",null,"狀態：",-1))),w={key:1,class:"py-2 d-flex justify-center"},y={key:2},f={key:0,class:"div-container"},k={key:1,class:"div-container"},T={key:2,class:"div-container"},P={key:3,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},q={key:4,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},M={key:5,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}};function C(e,a,t,p,C,$){const j=(0,r.up)("WeekTable"),I=(0,r.up)("AllQuarterTable"),L=(0,r.up)("QuarterTable"),A=(0,r.up)("SiteSelectionChart");return(0,r.wg)(),(0,r.j4)(l.K,null,{default:(0,r.w5)((()=>[(0,r._)("div",d,[(0,r.Wm)(c.t,{color:"blue",onClick:$.goBack},{default:(0,r.w5)((()=>[(0,r.Uk)("mdi-chevron-left-box")])),_:1},8,["onClick"]),g]),(0,r._)("div",h,[(0,r.Wm)(c.t,{color:"orange"},{default:(0,r.w5)((()=>[(0,r.Uk)("mdi-chevron-right-box")])),_:1}),u,m]),(0,r._)("div",_,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(C.loops,(e=>((0,r.wg)(),(0,r.j4)(s.T,{key:e.loop_id,class:(0,n.C_)(["loop-button",{"loop-button--active":e.loop_id===C.selectedLoopId}]),onClick:a=>$.selectLoop(e.loop_id)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.loop_name),1)])),_:2},1032,["class","onClick"])))),128))]),(0,r._)("div",b,[C.selectedLoopId?((0,r.wg)(),(0,r.iD)("div",v,[D,(0,r.Wm)(s.T,{class:(0,n.C_)("table"===C.displayMode?"report-btn":"table-btn"),onClick:$.toggleDisplayMode},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)($.displayModeText),1)])),_:1},8,["class","onClick"])])):(0,r.kq)("",!0),C.showDetails&&"table"===C.displayMode?((0,r.wg)(),(0,r.iD)("div",w,[(0,r.Wm)(o.fF,{mandatory:"",modelValue:C.timeMode,"onUpdate:modelValue":a[0]||(a[0]=e=>C.timeMode=e),class:"time-toggle",variant:"outlined"},{default:(0,r.w5)((()=>[(0,r.Wm)(s.T,{class:"time-btn",value:"quarter"},{default:(0,r.w5)((()=>[(0,r.Uk)("季")])),_:1}),(0,r.Wm)(s.T,{class:"time-btn",value:"week"},{default:(0,r.w5)((()=>[(0,r.Uk)("週")])),_:1})])),_:1},8,["modelValue"])])):(0,r.kq)("",!0),C.selectedLoopId&&"table"===C.displayMode?((0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(s.T,{class:(0,n.C_)("engineering"===C.projectType?"bank-btn":"engineering-btn"),onClick:$.toggleProjectType},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)($.projectTypeText),1)])),_:1},8,["class","onClick"]),(0,r.Wm)(s.T,{class:(0,n.C_)(["overview-btn",{"btn-active":!C.showDetails}]),rounded:"0",variant:"outlined",onClick:a[1]||(a[1]=e=>C.showDetails=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 即時 ")])),_:1},8,["class"]),(0,r.Wm)(s.T,{class:(0,n.C_)(["details-btn",{"btn-active":C.showDetails}]),rounded:"0",variant:"outlined",onClick:a[2]||(a[2]=e=>C.showDetails=!0)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 詳情 ")])),_:1},8,["class"])])):(0,r.kq)("",!0)]),C.selectedLoopId&&"week"===C.timeMode&&C.showDetails&&"table"===C.displayMode?((0,r.wg)(),(0,r.iD)("div",f,[(0,r.Wm)(j,{percentagedata:C.percentageData,allDateRanges:$.allDateRanges,weekTableData:C.weekTableData},null,8,["percentagedata","allDateRanges","weekTableData"]),(0,r.Wm)(i.k,{modelValue:C.currentPage,"onUpdate:modelValue":a[3]||(a[3]=e=>C.currentPage=e),length:C.totalPages,"total-visible":7,onInput:$.fetchData},null,8,["modelValue","length","onInput"])])):(0,r.kq)("",!0),C.selectedLoopId&&"quarter"===C.timeMode&&C.showDetails&&"table"===C.displayMode?((0,r.wg)(),(0,r.iD)("div",k,[(0,r.Wm)(I,{percentagedata:C.percentageData,allDateRanges:$.allDateRanges,quarterSummary:$.quarterSummary,quarterTableData:C.quarterTableData},null,8,["percentagedata","allDateRanges","quarterSummary","quarterTableData"]),(0,r.Wm)(i.k,{modelValue:C.currentPage,"onUpdate:modelValue":a[4]||(a[4]=e=>C.currentPage=e),length:C.totalPages,"total-visible":7,onInput:$.fetchData},null,8,["modelValue","length","onInput"])])):(0,r.kq)("",!0),C.selectedLoopId&&!C.showDetails&&"table"===C.displayMode?((0,r.wg)(),(0,r.iD)("div",T,[(0,r.Wm)(L,{percentagedata:C.percentageData,allDateRanges:$.allDateRanges,quarterSummary:$.quarterSummary,TableData:C.TableData},null,8,["percentagedata","allDateRanges","quarterSummary","TableData"]),(0,r.Wm)(i.k,{modelValue:C.currentPage,"onUpdate:modelValue":a[5]||(a[5]=e=>C.currentPage=e),length:C.totalPages,"total-visible":7,onInput:$.fetchData},null,8,["modelValue","length","onInput"])])):(0,r.kq)("",!0),C.selectedLoopId&&"report"===C.displayMode&&!C.showDetails?((0,r.wg)(),(0,r.iD)("div",P,[(0,r.Wm)(A,{chartData:C.chartData},null,8,["chartData"])])):(0,r.kq)("",!0),C.selectedLoopId&&"report"===C.displayMode&&C.showDetails&&"quarter"===C.timeMode?((0,r.wg)(),(0,r.iD)("div",q,[(0,r.Wm)(A,{chartData:C.chartData},null,8,["chartData"])])):(0,r.kq)("",!0),C.selectedLoopId&&"report"===C.displayMode&&C.showDetails&&"week"===C.timeMode?((0,r.wg)(),(0,r.iD)("div",M,[(0,r.Wm)(A,{chartData:C.chartData},null,8,["chartData"])])):(0,r.kq)("",!0)])),_:1})}t(560);var $=t(8541),j=t(639),I=t(1789),L=t(5023),A=t(440),W=t(9351),E={components:{WeekTable:j.Z,AllQuarterTable:I.Z,QuarterTable:L.Z,SiteSelectionChart:$.Z},data(){return{loops:[],cases:[],selectedProject:[],selectedPlan:null,selectedLoopId:null,timeMode:"week",displayMode:"table",projectType:"engineering",previousTimeMode:null,previousShowDetails:null,showDetails:!1,weekTableData:[],quarterTableData:[],TableData:[],itemsPerPage:3,currentPage:1,totalPages:0,chartData:{},percentageData:[{vb_name:"升三-A03區",percentage:.0635},{vb_name:"升四-K02區",percentage:.058},{vb_name:"升三-I02區",percentage:.0557},{vb_name:"升三-A02區-A棟",percentage:.0376},{vb_name:"升三-A02區-B棟",percentage:.0376},{vb_name:"升三-F01區",percentage:.1506},{vb_name:"升四-K01區",percentage:.1318},{vb_name:"升三-B01區",percentage:.1294},{vb_name:"升三-I01區",percentage:.1216},{vb_name:"升三-E01區",percentage:.1153},{vb_name:"升三-F02區",percentage:.0988},{vb_name:"升三-D01區",percentage:.0534},{vb_name:"升四-D03區",percentage:.054},{vb_name:"升四-D04區",percentage:.0492},{vb_name:"升四-G01區",percentage:.0328},{vb_name:"升四-G02區",percentage:.0534},{vb_name:"升四-H03區",percentage:.0358},{vb_name:"升四-H06區",percentage:.0419},{vb_name:"升三-H01區",percentage:.0528},{vb_name:"升三-H02區",percentage:.1342},{vb_name:"升四-H04區",percentage:.3103},{vb_name:"升四-H05區",percentage:.1821},{vb_name:"升三-C09區",percentage:.0731},{vb_name:"升三-B02區",percentage:.0724},{vb_name:"升三-C01區",percentage:.0613},{vb_name:"升三-C07區",percentage:.2347},{vb_name:"升三-C03區",percentage:.2228},{vb_name:"升三-C08區",percentage:.1866},{vb_name:"升三-C02區",percentage:.149},{vb_name:"升四-E05區-A棟",percentage:.0423},{vb_name:"升四-E05區-B棟",percentage:.041},{vb_name:"升四-E06區",percentage:.0357},{vb_name:"升四-J01區",percentage:.1389},{vb_name:"升三-E02區",percentage:.119},{vb_name:"升三-E04區-A棟",percentage:.1164},{vb_name:"升三-E04區-B棟",percentage:.1058},{vb_name:"升三-E03區",percentage:.2123},{vb_name:"升三-F03區",percentage:.1885},{vb_name:"升四-D02區",percentage:.0541},{vb_name:"升四-A04區",percentage:.0456},{vb_name:"升四-H10區-B棟",percentage:.0428},{vb_name:"升四-H08區",percentage:.0266},{vb_name:"升三-A01區",percentage:.1291},{vb_name:"升四-G06區",percentage:.1234},{vb_name:"升四-H09區",percentage:.1065},{vb_name:"升四-G05區",percentage:.0984},{vb_name:"升四-G07區",percentage:.0984},{vb_name:"升四-H10區-A棟",percentage:.2751},{vb_name:"升四-G04區",percentage:.0759},{vb_name:"升四-H07區",percentage:.0619},{vb_name:"升四-G03區",percentage:.1758},{vb_name:"升四-L02區",percentage:.1439},{vb_name:"升四-L03區",percentage:.1279},{vb_name:"升四-L01區",percentage:.4146},{vb_name:"升四-C15區",percentage:.117},{vb_name:"升三-C05區-A棟",percentage:.2089},{vb_name:"升三-C06區",percentage:.2023},{vb_name:"升三-C04區-A棟",percentage:.1886},{vb_name:"升三-C04區-B棟",percentage:.1509},{vb_name:"升三-C05區-B棟",percentage:.1323},{vb_name:"升四-C13區",percentage:.0654},{vb_name:"升四-F04區",percentage:.1308},{vb_name:"升四-F05區",percentage:.0846},{vb_name:"升四-C11區",percentage:.2212},{vb_name:"升四-C10區",percentage:.1744},{vb_name:"升四-C14區",percentage:.1724},{vb_name:"升四-C12區",percentage:.1513},{vb_name:"升四-F06區",percentage:.0634},{vb_name:"升四-F07區-C棟",percentage:.3361},{vb_name:"升四-F07區-A棟",percentage:.3303},{vb_name:"升四-F07區-B棟",percentage:.2702}]}},watch:{selectedLoopId:function(e,a){e!==a&&(this.fetchData(),this.displayMode="table")},showDetails:"fetchData",currentPage:"fetchData",projectType:"fetchData",timeMode:"fetchData",displayMode:"fetchData"},async created(){this.selectedPlan=this.$route.query.Plan,this.selectedProject=this.$route.query.Project,await this.fetchLoops()},computed:{displayModeText(){return"table"===this.displayMode?"表格":"報表"},projectTypeText(){return"engineering"===this.projectType?"工程":"銀行"},allDateRanges(){const e=new Set;return this.showDetails?"week"===this.timeMode?this.weekTableData.forEach((a=>{a.date_ranges.forEach((a=>{e.add(a.date_range)}))})):"quarter"===this.timeMode&&this.quarterTableData.forEach((a=>{a.date_ranges.forEach((a=>{e.add(a.date_range)}))})):this.TableData.forEach((a=>{a.date_ranges.forEach((a=>{e.add(a.date_range)}))})),Array.from(e)},quarterSummary(){let e=this.showDetails?this.quarterTableData:this.TableData;if(!e.length)return[];const a=new Set;return e.forEach((e=>{e.date_ranges.forEach((e=>{const t=`${e.year}-Q${e.quarter}-${e.week}`;a.add(t)}))})),Array.from(a).map((e=>{const[a,t,r]=e.split("-");return{year:a,quarter:t.replace("Q",""),week:r}}))}},methods:{goBack(){this.$router.go(-1)},toggleDisplayMode(){"table"===this.displayMode?(this.previousTimeMode=this.timeMode,this.previousShowDetails=this.showDetails,this.displayMode="report"):(this.displayMode="table",this.timeMode=this.previousTimeMode,this.showDetails=this.previousShowDetails)},organizeTableData(e){const a=[],t=new Map;return e.forEach((e=>{const{vb_name:a,date_range:r,construction_status:n,actual:s,expected:o,year:l,quarter:c,week:i}=e;t.has(a)||t.set(a,{vb_name:a,construction_status:n,date_ranges:[]});const p=t.get(a);let d=p.date_ranges.find((e=>e.date_range===r));d||(d={date_range:r,records:[],year:l,quarter:c,week:i},p.date_ranges.push(d)),d.records.push({actual:s,expected:o}),void 0!==l&&(d.year=l),void 0!==c&&(d.quarter=c),void 0!==i&&(d.week=i)})),t.forEach((e=>a.push(e))),a.sort(((e,a)=>{const t=e.date_ranges.some((e=>e.records.some((e=>e.actual>0||e.expected>0)))),r=a.date_ranges.some((e=>e.records.some((e=>e.actual>0||e.expected>0))));return r-t})),console.log(a),a},async fetchLoops(){try{console.log("api response:",this.selectedProject);const{data:e}=await(0,A.m0)(this.selectedProject);this.loops=e}catch(e){console.error("Error fetching loops:",e)}},async fetchData(){if(this.selectedLoopId){this.isLoading=!0;try{let e,a;if(console.log(this.selectedLoopId,this.currentPage,this.itemsPerPage,this.projectType),this.showDetails)if(this.showDetails&&"week"===this.timeMode)e=await(0,W.ob)(this.selectedLoopId,this.currentPage,this.itemsPerPage,this.projectType),this.weekTableData=this.organizeTableData(e.data.results),a=await(0,W.QZ)(this.selectedLoopId,this.currentPage,this.itemsPerPage,this.projectType),this.chartData=a.data,console.log("chartData",this.chartData);else{if(!this.showDetails||"quarter"!==this.timeMode)return void console.error("Invalid time mode:",this.timeMode);e=await(0,W.ZP)(this.selectedLoopId,this.currentPage,this.itemsPerPage,this.projectType),this.quarterTableData=this.organizeTableData(e.data.results),a=await(0,W.Mw)(this.selectedLoopId,this.projectType),this.chartData=a.data,console.log("chartData",this.chartData)}else e=await(0,W.iY)(this.selectedLoopId,this.currentPage,this.itemsPerPage,this.projectType),this.TableData=this.organizeTableData(e.data.results),a=await(0,W.uf)(this.selectedLoopId,this.projectType),this.chartData=a.data,console.log("chartData",this.chartData);console.log(e.data.results),this.totalPages=e.data.totalPages}catch(e){console.error("Error fetching data:",e),this.weekTableData=[],this.quarterTableData=[]}finally{this.isLoading=!1}}},selectLoop(e){this.selectedLoopId=e},toggleProjectType(){this.projectType="engineering"===this.projectType?"bank":"engineering"}}},x=t(3744);const Z=(0,x.Z)(E,[["render",C],["__scopeId","data-v-85e7cc18"]]);var S=Z}}]);
//# sourceMappingURL=35.1abd79dc.js.map