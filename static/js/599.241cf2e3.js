"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[599],{9022:function(e,t,a){var s=a(5121);const o=s.Z.create({baseURL:"/",headers:{"Content-Type":"application/json"}});o.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>(console.error("Request error:",e),Promise.reject(e)))),o.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(window.location.href="/login"),Promise.reject(e)))),t.Z=o},4746:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});var s=a(6252),o=a(3577),r=a(9095),l=a(9773),i=a(1669),n=a(7737),c=a(2793);const d=e=>((0,s.dD)("data-v-fb7705c4"),e=e(),(0,s.Cn)(),e),h={class:"mb-3",style:{"padding-left":"20px",display:"flex","align-items":"center"}},u=d((()=>(0,s._)("span",{class:"font-weight-bold ml-2"},"瀏覽22.8KV工程進度：",-1))),g={class:"function-row"},p={class:"status-and-page-size-selector"},w=d((()=>(0,s._)("span",null,"狀態：",-1))),b={key:0,class:"py-2 d-flex justify-center"},D={key:1},m={key:0,class:"div-container"};function f(e,t,a,d,f,k){const T=(0,s.up)("WeekLoopTable");return(0,s.wg)(),(0,s.j4)(i.K,null,{default:(0,s.w5)((()=>[(0,s._)("div",h,[(0,s.Wm)(n.t,{color:"blue",onClick:k.goBack},{default:(0,s.w5)((()=>[(0,s.Uk)("mdi-chevron-left-box")])),_:1},8,["onClick"]),u]),(0,s._)("div",g,[(0,s._)("div",p,[w,(0,s.Wm)(r.T,{class:(0,o.C_)("table"===f.displayMode?"report-btn":"table-btn"),onClick:k.toggleDisplayMode},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.displayModeText),1)])),_:1},8,["class","onClick"])]),f.showDetails&&"table"===f.displayMode?((0,s.wg)(),(0,s.iD)("div",b,[(0,s.Wm)(l.fF,{mandatory:"",modelValue:f.timeMode,"onUpdate:modelValue":t[0]||(t[0]=e=>f.timeMode=e),class:"time-toggle",variant:"outlined"},{default:(0,s.w5)((()=>[(0,s.Wm)(r.T,{value:"quarter"},{default:(0,s.w5)((()=>[(0,s.Uk)("季")])),_:1}),(0,s.Wm)(r.T,{value:"week"},{default:(0,s.w5)((()=>[(0,s.Uk)("週")])),_:1})])),_:1},8,["modelValue"])])):(0,s.kq)("",!0),"table"===f.displayMode?((0,s.wg)(),(0,s.iD)("div",D,[(0,s.Wm)(r.T,{class:(0,o.C_)("engineering"===f.projectType?"bank-btn":"engineering-btn"),onClick:k.toggleProjectType},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.projectTypeText),1)])),_:1},8,["class","onClick"]),"engineering"===f.projectType?((0,s.wg)(),(0,s.j4)(r.T,{key:0,class:"custom-btn",onClick:t[1]||(t[1]=t=>e.scrollToSection("engineeringSection"))},{default:(0,s.w5)((()=>[(0,s.Uk)(" 土木/纜線進度 ")])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(r.T,{class:(0,o.C_)(["overview-btn",{"btn-active":!f.showDetails}]),rounded:"0",variant:"outlined",onClick:t[2]||(t[2]=e=>f.showDetails=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)(" 即時 ")])),_:1},8,["class"]),(0,s.Wm)(r.T,{class:(0,o.C_)(["details-btn",{"btn-active":f.showDetails}]),rounded:"0",variant:"outlined",onClick:t[3]||(t[3]=e=>f.showDetails=!0)},{default:(0,s.w5)((()=>[(0,s.Uk)(" 詳情 ")])),_:1},8,["class"])])):(0,s.kq)("",!0)]),"week"===f.timeMode&&f.showDetails&&"table"===f.displayMode?((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(T,{allDateRanges:k.allDateRanges,weekTableData:f.weekTableData},null,8,["allDateRanges","weekTableData"]),(0,s.Wm)(c.k,{modelValue:f.currentPage,"onUpdate:modelValue":t[4]||(t[4]=e=>f.currentPage=e),length:f.totalPages,"total-visible":7,onInput:k.fetchData},null,8,["modelValue","length","onInput"])])):(0,s.kq)("",!0)])),_:1})}a(560);var k=a(8541),T=a(8334),y=a(1738),v=a(614),_=a(9022);const P=(e,t,a,s)=>_.Z.get(`/api/v1/get_voltage228k_progress/${e}/${t}/${a}/${s}/`,{headers:{Accept:"application/json"}});var M={components:{WeekLoopTable:T.Z,AllQuarterLoopTable:y.Z,QuarterLoopTable:v.Z,SiteSelectionChart:k.Z},data(){return{tab:"civil",timeMode:"week",entimeMode:"week",displayMode:"table",endisplayMode:"table",projectType:"engineering",selectedProject:null,showDetails:!1,enshowDetails:!1,weekTableData:[],quarterTableData:[],TableData:[],civilWeekTableData:[],civilQuarterTableData:[],civilTableData:[],cableWeekTableData:[],cableQuarterTableData:[],cableTableData:[],itemsPerPage:3,currentPage:1,totalPages:0,chartData:{labels:[],datasets:[]},enchartData:{labels:[],datasets:[]}}},watch:{showDetails:"fetchData",currentPage:"fetchData",projectType:"fetchData",timeMode:"fetchData",displayMode:"fetchData"},async created(){this.selectedPlan=this.$route.query.Plan,this.selectedProject=this.$route.query.Project},computed:{displayModeText(){return"table"===this.displayMode?"表格":"報表"},projectTypeText(){return"engineering"===this.projectType?"工程":"銀行"},allDateRanges(){const e=new Set;return this.showDetails?"week"===this.timeMode?this.weekTableData.forEach((t=>{t.date_ranges.forEach((t=>{e.add(t.date_range)}))})):"quarter"===this.timeMode&&this.quarterTableData.forEach((t=>{t.date_ranges.forEach((t=>{e.add(t.date_range)}))})):this.TableData.forEach((t=>{t.date_ranges.forEach((t=>{e.add(t.date_range)}))})),Array.from(e)},quarterSummary(){let e=this.showDetails?this.quarterTableData:this.TableData;if(!e.length)return[];const t=new Set;return e.forEach((e=>{e.date_ranges.forEach((e=>{const a=`${e.year}-Q${e.quarter}-${e.week}`;t.add(a)}))})),Array.from(t).map((e=>{const[t,a,s]=e.split("-");return{year:t,quarter:a.replace("Q",""),week:s}}))}},methods:{goBack(){this.$router.go(-1)},toggleDisplayMode(){"table"===this.displayMode?(this.previousTimeMode=this.timeMode,this.previousShowDetails=this.showDetails,this.displayMode="report"):(this.displayMode="table",this.timeMode=this.previousTimeMode,this.showDetails=this.previousShowDetails)},organizeTableData(e){const t=[],a=new Map;return e.forEach((e=>{const{loop_name:t,date_range:s,actual:o,expected:r,year:l,quarter:i,week:n}=e;a.has(t)||a.set(t,{loop_name:t,date_ranges:[]});const c=a.get(t);let d=c.date_ranges.find((e=>e.date_range===s));d||(d={date_range:s,records:[],year:l,quarter:i,week:n},c.date_ranges.push(d)),d.records.push({actual:o,expected:r}),void 0!==l&&(d.year=l),void 0!==i&&(d.quarter=i),void 0!==n&&(d.week=n)})),a.forEach((e=>{t.push(e)})),console.log(t),t},async fetchData(){try{let e;if(console.log(this.selectedProject,this.currentPage,this.itemsPerPage,this.projectType),this.showDetails){if(this.showDetails&&"week"===this.timeMode)e=await P(this.selectedProject,this.currentPage,this.itemsPerPage,this.projectType),console.log(e.data.results),this.weekTableData=this.organizeTableData(e.data.results);else if(!this.showDetails||"quarter"!==this.timeMode)return void console.error("Invalid time mode:",this.timeMode)}else;console.log(e.data.results),this.totalPages=e.data.totalPages}catch(e){console.error("Error fetching data:",e),this.weekTableData=[],this.quarterTableData=[]}finally{this.isLoading=!1}},async fetchData(){try{let e;if(console.log(this.selectedProject,this.currentPage,this.itemsPerPage,this.projectType),this.showDetails){if(this.showDetails&&"week"===this.timeMode)e=await P(this.selectedProject,this.currentPage,this.itemsPerPage,this.projectType),console.log(e.data.results),this.weekTableData=this.organizeTableData(e.data.results);else if(!this.showDetails||"quarter"!==this.timeMode)return void console.error("Invalid time mode:",this.timeMode)}else;console.log(e.data.results),this.totalPages=e.data.totalPages}catch(e){console.error("Error fetching data:",e),this.weekTableData=[],this.quarterTableData=[]}finally{this.isLoading=!1}},toggleProjectType(){this.projectType="engineering"===this.projectType?"bank":"engineering"}}},j=a(3744);const q=(0,j.Z)(M,[["render",f],["__scopeId","data-v-fb7705c4"]]);var C=q}}]);
//# sourceMappingURL=599.241cf2e3.js.map