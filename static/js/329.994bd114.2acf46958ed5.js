"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[329],{9590:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});var r=a(6252),c=a(3577),n=a(9095),o=a(9773),s=a(1669),l=a(7737),u=a(2793);const d=e=>((0,r.dD)("data-v-5c478eb7"),e=e(),(0,r.Cn)(),e),i={class:"mb-3",style:{"padding-left":"20px",display:"flex","align-items":"center"}},p=d((()=>(0,r._)("span",{class:"font-weight-bold ml-2"},"瀏覽管理總表工程進度：",-1))),g={class:"function-row"},_={class:"status-and-page-size-selector"},h=d((()=>(0,r._)("span",null,"狀態：",-1))),m={key:0,class:"py-2 d-flex justify-center"},b={key:0,class:"div-container"},D={key:1,class:"div-container"},w={key:2,class:"div-container"},x={key:3,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},j={key:4,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}},y={key:5,class:"div-container report-container",style:{"background-color":"white",display:"flex",height:"100%"}};function k(e,t,a,d,k,f){const q=(0,r.up)("WeekProjectTable"),T=(0,r.up)("AllQuarterProjectTable"),C=(0,r.up)("QuarterProjectTable"),V=(0,r.up)("SiteSelectionChart");return(0,r.wg)(),(0,r.j4)(s.K,null,{default:(0,r.w5)((()=>[(0,r._)("div",i,[(0,r.Wm)(l.t,{color:"blue",onClick:f.goBack},{default:(0,r.w5)((()=>[(0,r.Uk)("mdi-chevron-left-box")])),_:1},8,["onClick"]),p]),(0,r._)("div",g,[(0,r._)("div",_,[h,(0,r.Wm)(n.T,{class:(0,c.C_)("table"===k.displayMode?"report-btn":"table-btn"),onClick:f.toggleDisplayMode},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(f.displayModeText),1)])),_:1},8,["class","onClick"])]),k.showDetails?((0,r.wg)(),(0,r.iD)("div",m,[(0,r.Wm)(o.fF,{mandatory:"",modelValue:k.timeMode,"onUpdate:modelValue":t[0]||(t[0]=e=>k.timeMode=e),class:"time-toggle",variant:"outlined"},{default:(0,r.w5)((()=>[(0,r.Wm)(n.T,{class:"time-btn",value:"quarter"},{default:(0,r.w5)((()=>[(0,r.Uk)("季")])),_:1}),(0,r.Wm)(n.T,{class:"time-btn",value:"week"},{default:(0,r.w5)((()=>[(0,r.Uk)("週")])),_:1})])),_:1},8,["modelValue"])])):(0,r.kq)("",!0),(0,r._)("div",null,[(0,r.Wm)(n.T,{class:(0,c.C_)("engineering"===k.projectType?"bank-btn":"engineering-btn"),onClick:f.toggleProjectType},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(f.projectTypeText),1)])),_:1},8,["class","onClick"]),(0,r.Wm)(n.T,{class:(0,c.C_)(["overview-btn",{"btn-active":!k.showDetails}]),rounded:"0",variant:"outlined",onClick:t[1]||(t[1]=e=>k.showDetails=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 即時 ")])),_:1},8,["class"]),(0,r.Wm)(n.T,{class:(0,c.C_)(["details-btn",{"btn-active":k.showDetails}]),rounded:"0",variant:"outlined",onClick:t[2]||(t[2]=e=>k.showDetails=!0)},{default:(0,r.w5)((()=>[(0,r.Uk)(" 詳情 ")])),_:1},8,["class"])])]),"week"===k.timeMode&&k.showDetails&&"table"===k.displayMode?((0,r.wg)(),(0,r.iD)("div",b,[(0,r.Wm)(q,{allDateRanges:f.paginatedDateRanges,weekTableData:f.paginatedData,percentagedata:k.percentageData},null,8,["allDateRanges","weekTableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:k.currentPage,"onUpdate:modelValue":t[3]||(t[3]=e=>k.currentPage=e),length:f.totalPages},null,8,["modelValue","length"])])):(0,r.kq)("",!0),"quarter"===k.timeMode&&k.showDetails&&"table"===k.displayMode?((0,r.wg)(),(0,r.iD)("div",D,[(0,r.Wm)(T,{allDateRanges:f.paginatedDateRanges,quarterSummary:f.quarterSummary,quarterTableData:f.paginatedData,percentagedata:k.percentageData},null,8,["allDateRanges","quarterSummary","quarterTableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:k.currentPage,"onUpdate:modelValue":t[4]||(t[4]=e=>k.currentPage=e),length:f.totalPages},null,8,["modelValue","length"])])):(0,r.kq)("",!0),k.showDetails||"table"!==k.displayMode?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",w,[(0,r.Wm)(C,{allDateRanges:f.paginatedDateRanges,quarterSummary:f.quarterSummary,TableData:f.paginatedData,percentagedata:k.percentageData},null,8,["allDateRanges","quarterSummary","TableData","percentagedata"]),(0,r.Wm)(u.k,{modelValue:k.currentPage,"onUpdate:modelValue":t[5]||(t[5]=e=>k.currentPage=e),length:f.totalPages},null,8,["modelValue","length"])])),"report"!==k.displayMode||k.showDetails?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",x,[(0,r.Wm)(V,{chartData:k.chartData},null,8,["chartData"])])),"report"===k.displayMode&&k.showDetails&&"quarter"===k.timeMode?((0,r.wg)(),(0,r.iD)("div",j,[(0,r.Wm)(V,{chartData:k.chartData},null,8,["chartData"])])):(0,r.kq)("",!0),"report"===k.displayMode&&k.showDetails&&"week"===k.timeMode?((0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(V,{chartData:k.chartData},null,8,["chartData"])])):(0,r.kq)("",!0)])),_:1})}a(560);var f=a(8541),q=a(4270),T=a(3210),C=a(6735),V={components:{SiteSelectionChart:f.Z,WeekProjectTable:q.Z,AllQuarterProjectTable:T.Z,QuarterProjectTable:C.Z},data(){return{timeMode:"week",displayMode:"table",projectType:"engineering",showDetails:!1,weekTableData:[{actual:.3317,construction_status:2,date_range:"2023-12-30 - 2024-01-06",expected:.3317,project_name:"161KV"},{actual:7e-4,construction_status:2,date_range:"2023-12-30 - 2024-01-06",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2023-12-30 - 2024-01-06",expected:.0095,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-01-07 - 2024-01-13",expected:.3317,project_name:"161KV"},{actual:0,construction_status:2,date_range:"2024-01-07 - 2024-01-13",expected:.0054,project_name:"22.8KV"},{actual:7e-4,construction_status:2,date_range:"2024-01-07 - 2024-01-13",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-01-07 - 2024-01-13",expected:.019,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-01-14 - 2024-01-20",expected:.3317,project_name:"161KV"},{actual:0,construction_status:2,date_range:"2024-01-14 - 2024-01-20",expected:.0108,project_name:"22.8KV"},{actual:.0033,construction_status:2,date_range:"2024-01-14 - 2024-01-20",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-01-14 - 2024-01-20",expected:.0286,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-01-21 - 2024-01-27",expected:.3317,project_name:"161KV"},{actual:.0949,construction_status:2,date_range:"2024-01-21 - 2024-01-27",expected:.0162,project_name:"22.8KV"},{actual:.004,construction_status:2,date_range:"2024-01-21 - 2024-01-27",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-01-21 - 2024-01-27",expected:.0381,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-01-28 - 2024-02-03",expected:.3317,project_name:"161KV"},{actual:.0949,construction_status:2,date_range:"2024-01-28 - 2024-02-03",expected:.0216,project_name:"22.8KV"},{actual:.004,construction_status:2,date_range:"2024-01-28 - 2024-02-03",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-01-28 - 2024-02-03",expected:.0476,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-02-04 - 2024-02-10",expected:.3317,project_name:"161KV"},{actual:.0949,construction_status:2,date_range:"2024-02-04 - 2024-02-10",expected:.027,project_name:"22.8KV"},{actual:.004,construction_status:2,date_range:"2024-02-04 - 2024-02-10",expected:0,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-02-04 - 2024-02-10",expected:.0571,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-02-11 - 2024-02-17",expected:.3317,project_name:"161KV"},{actual:.0949,construction_status:2,date_range:"2024-02-11 - 2024-02-17",expected:.0324,project_name:"22.8KV"},{actual:.004,construction_status:2,date_range:"2024-02-11 - 2024-02-17",expected:.0016,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-02-11 - 2024-02-17",expected:.0667,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:.3317,project_name:"161KV"},{actual:.0949,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:.0378,project_name:"22.8KV"},{actual:.0051,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:.0024,project_name:"案場"},{actual:.1181,construction_status:2,date_range:"2024-02-18 - 2024-02-24",expected:.0762,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:.3317,project_name:"161KV"},{actual:.0964,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:.0432,project_name:"22.8KV"},{actual:.0051,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:.0036,project_name:"案場"},{actual:.3114,construction_status:2,date_range:"2024-02-25 - 2024-03-02",expected:.0857,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:.3317,project_name:"161KV"},{actual:.0964,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:.0486,project_name:"22.8KV"},{actual:.0051,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:.0053,project_name:"案場"},{actual:.3114,construction_status:2,date_range:"2024-03-03 - 2024-03-09",expected:.0952,project_name:"電業申辦"},{actual:.3317,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.3317,project_name:"161KV"},{actual:.0964,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.054,project_name:"22.8KV"},{actual:.01,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0077,project_name:"案場"},{actual:.3114,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.1048,project_name:"電業申辦"}],quarterTableData:[{actual:.3317,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.3317,project_name:"161KV",year:2024,quarter:1,week:11},{actual:.0964,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.054,project_name:"22.8KV",year:2024,quarter:1,week:11},{actual:.01,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0077,project_name:"案場",year:2024,quarter:1,week:11},{actual:.3114,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.1048,project_name:"電業申辦",year:2024,quarter:1,week:11}],TableData:[{actual:.3317,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.3317,project_name:"161KV",year:2024,quarter:1,week:11},{actual:.0964,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.054,project_name:"22.8KV",year:2024,quarter:1,week:11},{actual:.01,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.0077,project_name:"案場",year:2024,quarter:1,week:11},{actual:.3114,construction_status:2,date_range:"2024-03-10 - 2024-03-16",expected:.1048,project_name:"電業申辦",year:2024,quarter:1,week:11}],currentPage:1,perPage:3,chartData:{labels:[],datasets:[]},percentageData:[{project_name:"161KV",percentage:.0267277017620372},{project_name:"22.8KV",percentage:.0975749550966081},{project_name:"案場",percentage:.825697343141355},{project_name:"電業申辦",percentage:.5}]}},watch:{displayMode(){this.updateChartData()},timeMode(){this.updateChartData()},showDetails(){this.updateChartData()}},async created(){this.selectedPlan=this.$route.query.Plan,this.selectedProject=this.$route.query.Project},computed:{displayModeText(){return"table"===this.displayMode?"表格":"報表"},projectTypeText(){return"engineering"===this.projectType?"工程":"銀行"},allDateRanges(){const e=new Set;return this.organizedLoopsData.forEach((t=>{t.date_ranges.forEach((t=>{e.add(t.date_range)}))})),Array.from(e)},quarterSummary(){let e=this.organizedLoopsData;if(console.log(e),!e.length)return[];const t=new Set;return e.forEach((e=>{e.date_ranges.forEach((e=>{const a=`${e.year}-Q${e.quarter}-${e.week}`;t.add(a)}))})),Array.from(t).map((e=>{const[t,a,r]=e.split("-");return{year:t,quarter:a.replace("Q",""),week:r}}))},totalPages(){const e=this.allDateRanges.length;return Math.ceil(e/this.perPage)},paginatedData(){this.organizedLoopsData.forEach((e=>{e.date_ranges.sort(((e,t)=>new Date(t.date_range.split(" - ")[0])-new Date(e.date_range.split(" - ")[0])))}));const e=this.organizedLoopsData.map((e=>{const t=[e.date_ranges[0]];let a=[];if(1===this.currentPage)a=e.date_ranges.slice(1,3);else{const t=1+3*(this.currentPage-2)+2,r=t+3;a=e.date_ranges.slice(t,r)}return{project_name:e.project_name,date_ranges:[...t,...a]}}));return e},paginatedDateRanges(){const e=(this.currentPage-1)*this.perPage,t=e+this.perPage,a=this.allDateRanges.sort(((e,t)=>new Date(t.split(" - ")[0])-new Date(e.split(" - ")[0]))),r=a[0];let c=a.slice(e,t);return c.includes(r)||(c=[r,...c].slice(0,t-e+1)),c},organizedLoopsData(){const e=[],t=new Map;let a=[];return this.showDetails?"quarter"===this.timeMode?a=this.quarterTableData:"week"===this.timeMode&&(a=this.weekTableData):a=this.TableData,a.forEach((e=>{const{project_name:a,construction_status:r,date_range:c,actual:n,expected:o,year:s,quarter:l,week:u}=e;t.has(a)||t.set(a,{project_name:a,date_ranges:[]});const d=t.get(a);let i=d.date_ranges.find((e=>e.date_range===c));i||(i={date_range:c,construction_status:r,records:[],year:s,quarter:l,week:u},d.date_ranges.push(i)),i.records.push({actual:n,expected:o})})),t.forEach((t=>{t.date_ranges.sort(((e,t)=>{const a=new Date(e.date_range.split(" - ")[0]),r=new Date(t.date_range.split(" - ")[0]);return r-a})),e.push(t)})),e}},methods:{goBack(){this.$router.go(-1)},toggleDisplayMode(){"table"===this.displayMode?(this.previousTimeMode=this.timeMode,this.previousShowDetails=this.showDetails,this.displayMode="report"):(this.displayMode="table",this.timeMode=this.previousTimeMode,this.showDetails=this.previousShowDetails)},toggleProjectType(){this.projectType="engineering"===this.projectType?"bank":"engineering"},generateChartData(){const e=(new Date).getFullYear(),t=this.TableData.filter((t=>t.year===e)),a=new Set(t.map((e=>`Q${e.quarter}`))),r=Array.from(a).sort(),c=new Map;t.forEach((e=>{const t=`Q${e.quarter}`,a=e.project_name;c.has(a)||c.set(a,{actual:Array(r.length).fill(null),expected:Array(r.length).fill(null)});const n=c.get(a),o=r.indexOf(t);-1!==o&&(n.actual[o]=100*e.actual,n.expected[o]=100*e.expected)}));const n=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let o=0;const s=[];return c.forEach(((e,t)=>{const a=n[o++%n.length].color;s.push({label:`${t} Actual`,data:e.actual,backgroundColor:a,borderColor:a.replace("0.2","1"),borderWidth:5}),s.push({label:`${t} Expected`,data:e.expected,backgroundColor:a,borderColor:a.replace("0.2","1"),borderDash:[5,5]})})),{labels:r,datasets:s}},generateyearChartData(){const e=(new Date).getFullYear(),t=this.quarterTableData.filter((t=>t.year===e)),a=[...new Set(t.map((e=>`${e.year}Q${e.quarter}`)))].sort(),r=new Map;t.forEach((e=>{const t=`${e.year}Q${e.quarter}`,c=e.project_name;r.has(c)||r.set(c,{actual:Array(a.length).fill(null),expected:Array(a.length).fill(null)});const n=r.get(c),o=a.indexOf(t);-1!==o&&(n.actual[o]=100*e.actual,n.expected[o]=100*e.expected)}));const c=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let n=0;const o=[];return r.forEach(((e,t)=>{const a=c[n++%c.length].color;o.push({label:`${t} Actual`,data:e.actual,backgroundColor:a,borderColor:a.replace("0.2","1"),borderWidth:5}),o.push({label:`${t} Expected`,data:e.expected,backgroundColor:a,borderColor:a.replace("0.2","1"),borderDash:[5,5]})})),{labels:a,datasets:o}},generatedaterangeChartData(){(new Date).getFullYear();const e=this.weekTableData,t=[...new Set(e.map((e=>e.date_range)))].sort(),a=new Map;e.forEach((e=>{const r=e.date_range,c=e.project_name;a.has(c)||a.set(c,{actual:Array(t.length).fill(null),expected:Array(t.length).fill(null)});const n=a.get(c),o=t.indexOf(r);-1!==o&&(n.actual[o]=100*e.actual,n.expected[o]=100*e.expected)}));const r=[{color:"rgba(255, 99, 132, 0.2)"},{color:"rgba(75, 192, 192, 0.2)"},{color:"rgba(255, 206, 86, 0.2)"},{color:"rgba(153, 102, 255, 0.2)"},{color:"rgba(255, 159, 64, 0.2)"},{color:"rgba(54, 162, 235, 0.2)"},{color:"rgba(104, 132, 245, 0.2)"},{color:"rgba(164, 206, 78, 0.2)"},{color:"rgba(215, 86, 255, 0.2)"}];let c=0;const n=[];return a.forEach(((e,t)=>{const a=r[c++%r.length].color;n.push({label:`${t} Actual`,data:e.actual,backgroundColor:a,borderColor:a.replace("0.2","1"),borderWidth:5}),n.push({label:`${t} Expected`,data:e.expected,backgroundColor:a,borderColor:a.replace("0.2","1"),borderDash:[5,5]})})),{labels:t,datasets:n}},updateChartData(){this.showDetails?"quarter"===this.timeMode?this.chartData=this.generateyearChartData():"week"===this.timeMode&&(this.chartData=this.generatedaterangeChartData()):this.chartData=this.generateChartData()}}},M=a(3744);const v=(0,M.Z)(V,[["render",k],["__scopeId","data-v-5c478eb7"]]);var P=v}}]);
//# sourceMappingURL=329.994bd114.js.31dda33331d3.map